<!doctype html>
<html>
	<head>
		<title>ChatRoom</title>

		<link type="stylesheet" rel="stylesheet" href="./css/main.css" />
		<link href="css/popupGirl.css" rel="stylesheet"/>
		<style> /* outline to make a box around own message */
			.is-admin{
				border: solid white 1px;
			}
		</style>
		<script src="/socket.io/socket.io.js"></script>
<!-- 		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script> -->
		<script src="js/jquery.js"></script> <!-- jquery library locally -->

		<script>
			var CHAT_ADMIN_NAME = "Chat Admin";
			var KEYCODE_ENTER_BUTTON = 13;
			
/* 			$(document).ready(function() { */
				var socket = io.connect('http://192.168.0.18'); //change this IP address
				
				var username = "Admin";
				var pass = "Password";
				var room = false;
				
				var latestMessage; //might not be nessisary
				var latestUsername; //might not be nessisary
				var latestClass; //might not be nessisary
	
	
	
	
/* ALL OF THIS IS TRYING TO MAKE STATUS THINGS								 */
				var boyStatus = false;
				var girlStatus = false;
				var adminStatus = true;
				
				
				
				//sends that admin has joined
				if(adminStatus){
					var data = {};
					data.status = true;
					socket.emit('admin present', data);
				}
					
				//listens for girl joining	
				socket.on("girl here",function(data) {
					changeColor('#girlStatus', '#FF3366');
				});
				
				//listens for boy joining
				socket.on("boy here",function(data) {
					changeColor('#boyStatus', '#66CCCC');
				});
				
				//changes own color
				changeColor('#adminStatus', '#c0cd00');
				
				//function to change box color
				function changeColor(box, color) {
					$(box).css('background-color', color);
				}
/* ALL OF THIS IS TRYING TO MAKE STATUS THINGS								 */


			/*
socket.on('user joined',function(username) {
					appendMessage("Chat Admin",username + " has joined the room.",["is-admin"]);
				});
*/
				//publishing girl messages to this screen
				socket.on("girl chatted",function(data) {
					appendMessage(data.username,data.message,["is-girl"]);
					latestMessage = data.message;  //might not be nessisary
					latestUsername = data.username; //might not be nessisary
					latestClass = "is-girl"; //might not be nessisary
				});
				
				//publishing boy messages to this screen
				socket.on("boy chatted",function(data) {
					appendMessageBoy(data.username,data.message,["is-boy"]);
					latestMessage = data.message; //might not be nessisary
					latestUsername = data.username; //might not be nessisary
					latestClass = "is-boy"; //might not be nessisary;
				});
	
				
				function doit() {
					var data = {};
					data.room = room;
					data.username = latestUsername;
					data.message = latestMessage;
					socket.emit('admin forwards', data);
				}
				
				function reject() {
					window.alert("YAY");
					var data = {};
					data.room = room;
					data.username = latestUsername;
					data.message = latestMessage;
					
					socket.emit('admin rejects', data);

				}

				function forward() {
					window.alert("YAY");
					var data = {};
					data.room = room;
					data.username = latestUsername;
					data.message = latestMessage;
					socket.emit('admin forwards', data);

				}
								
				// adding messages publishing on its own screen
				function appendMessage(username,message,classes) {
					if(!classes) classes = [];
					var p = $("<p></p>");
					var span = $("<span></span>");
					span.addClass("username");
					span.text(username);
					p.append(span);
					p.append(":  ");
					p.append(message);
					
					$.each(classes,function(i,className) {
						p.addClass(className); //the current class - is boy or is girl
					});
					$("#boxAdmin").append(p);
					// scroll down so we can see the latest!
					$("#boxAdmin").scrollTop($("#boxAdmin")[0].scrollHeight);
				}
				
				// adding messages publishing on its own screen
				function appendMessageBoy(username,message,classes) {
					if(!classes) classes = [];
					var rejectButton = $('<button id="reject" onclick="reject()">Reject</button>');
					var forwardButton = $('<button id="forward" onclick="forward()">Forward</button>');
					var p = $("<p></p>");
					var span = $("<span></span>");
					span.addClass("username");
					span.text(username);
					p.append(rejectButton);
					p.append(span);
					p.append(":  ");
					p.append(message);
					p.append(forwardButton);					
					
					$.each(classes,function(i,className) {
						p.addClass(className); //the current class - is boy or is girl
					});
					$("#boxAdmin").append(p);
					// scroll down so we can see the latest!
					$("#boxAdmin").scrollTop($("#boxAdmin")[0].scrollHeight);
				}
				
				
				//clicking in boxes
				$("#password").click(function() {
					$(this).val("");
				});
				
				// changing usernames
/*
				$("#submitButton").click(function() {
						var textBox = document.getElementById("girlUsernameInput");
						var newUsername = $.trim($(textBox).val());
						if(newUsername != "") {
							var data = {};
							data.room = room;
							data.oldName = username;
							username = newUsername;
							data.newName = username;

							socket.emit('user changed name',data);
							$(textBox).val("");
							appendMessage(CHAT_ADMIN_NAME,"You now go by " + data.newName + ".",["is-admin"]);
					}

					return false;
				});
*/

				// translating messages
				$("#chatboxAdmin").keyup(function(evt) {

					if(evt.keyCode == KEYCODE_ENTER_BUTTON) {
						var data = {};
						data.room = room;
						data.username = username;
						data.message = $(this).val();
						/*
data.latestU = latestUsername;
						data.latestM = latestMessage;
						data.latestC = latestClass;
*/
						
						socket.emit('admin sends translation',data);
						appendMessage(data.username,data.message,["is-admin"]);

						$(this).val(""); // clears the box for the next message.
					}

					return false;
				});
				
				/*
$("#forward").click(function() {//admin clicks on the forward button and send message in both directions(boy and girl)
					window.alert("YAY");
					var data = {};
					data.room = room;
					data.username = latestUsername;
					data.message = latestMessage;
					socket.emit('admin forwards', data);
				});
				
				$("#reject").click(function() { //admin clicks on the reject button and send an automated message back to the boy
					window.alert("YAY");
					var data = {};
					data.room = room;
					data.username = latestUsername;
					data.message = latestMessage;
					
					socket.emit('admin rejects', data);
				});
*/



				$('#password').val(pass);
				//$("select").trigger("change"); // force the lobby to be selected.
/* 			}); */
			

		</script>
	</head>
	<body>
		<img id ="logo" src="images/logo.png">
		
		<section id="status">
			<div id="boyStatus"></div>
			<div id="adminStatus"></div>
			<div id="girlStatus"></div>
		</section>
		
		<div id="overlay">
            <div id="popup">
                <p><input type="text" id="password" val="Password" /></p>
                <p id="submitButton">Submit</p>
                <a id="closeButton" href="#"><img id="closeButtonImg" src="images/chatButton.png" /></a>
            </div>
        </div>    
        
		<div id="chat">
			<div id="boxAdmin">
			</div>
			<center><input id="chatboxAdmin" type="text" /></center>
		</div>
	
	</body>
</html>