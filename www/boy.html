<!-- TEST FROM QUINCY -->
<!doctype html>
<html>
	<head>
		<title>Chat Room</title>

		<link type="stylesheet" rel="stylesheet" href="./css/main.css" />
		<link href="css/popupBoy.css" rel="stylesheet"/>
		
		<style> /* outline to make a box around own message */
			p.is-boy{
				border: solid white 1px;
			}
		</style>
		<script src="/socket.io/socket.io.js"></script>
<!-- 		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
 -->
 			
		<script src="js/jquery.js"></script> <!-- jquery library locally -->
		<script src="js/jqueryui.js"></script> <!-- jqueryui library locally -->
		
		<script>
			var CHAT_ADMIN_NAME = "Chat Admin";
			var KEYCODE_ENTER_BUTTON = 13;

			$(document).ready(function() {
				var socket = io.connect('http://192.168.0.18'); //change this IP address
				
				
				var username = "What?";
				var room = false;


/* ALL OF THIS IS TRYING TO MAKE STATUS THINGS								 */
				
				var boyStatus = true;
				var girlStatus = false;
				var adminStatus = false;
				
				//sends that admin has joined
				if(boyStatus){
					var data = {};
					data.status = true;
					socket.emit('boy present', data);
				}
					
				//listens for girl joining	
				socket.on("girl here",function(data) {
					girlStatus = true;
					changeColor('#girlStatus', '#FF3366', girlStatus, girlStatus);
				});
				
				//listens for admin joining
				socket.on("admin here",function(data) {
					adminStatus = true;
					changeColor('#adminStatus', '#c0cd00', adminStatus, adminStatus);
				});
				
				//changes own color
				changeColor('#boyStatus', '#66CCCC', boyStatus, boyStatus);
				
				//function to change box color
				function changeColor(box, color, check1, check2) {
					if(check1 && check2){
						$(box).css('background-color', color);
					}
				}
/* ALL OF THIS IS TRYING TO MAKE STATUS THINGS								 */


				
				
				/*
socket.on('user joined',function(username) {
					appendMessage("Chat Admin",username + " has joined the room.",["is-admin"]);
				});
*/

				//socket.on('user left',function(username) {
				//	appendMessage(CHAT_ADMIN_NAME,username + " has left the room.",["is-admin"]);
				//});

				//socket.on('user changed name',function(oldName,newName) {
				//	appendMessage(CHAT_ADMIN_NAME,oldName + " is now known as " + newName,["is-admin"]);
				//});


				//admin sends an automated message when rejecting with the rejected message as a "rejected-message" class
				//he can then comment seperatly if he wants
				socket.on("admin rejects to boy",function(data) { 
					appendMessage("Admin", "This message was rejected", ["is-admin"]);
					appendMessage(username,data.message,["rejected-message"]);
				});
				
				socket.on("admin translation to boy",function(data) {
/* 					appendMessage(data.latestU,data.latestM,[data.latestC]); //original message */
					appendMessage(data.username,data.message,["is-admin"]); //new translation or comment on rejected message
				});
				
				//girl messages come directly to boy
				socket.on("girl chatted",function(data) {
					appendMessage(data.username,data.message,["is-girl"]);
				});
				/*
socket.on("approved message",function(data) {
					appendMessage(data.username,data.message,["is-boy"]); //his approved message that was sent to the girl displayed on his screen
				});
*/

				//his approved message that was sent to the girl displayed on his screen
				socket.on("admin forwards to girl",function(data) {
					appendMessage(data.username,data.message,["is-boy"]);
				});


				// adding messages on this screen
				function appendMessage(username,message,classes) {
					if(!classes) classes = [];
					var p = $("<p></p>");
					var span = $("<span></span>");
					var source = classes;
					var img = $("<img src='images/" + source + ".png' class='chatImage " + classes + "' />");
					p.append(img);
					p.append(message);
					$.each(classes,function(i,className) {
						p.addClass(className);
					});
/* 					$("#boxBoy").append(p).hide().fadeIn(1000); */
					$(p).hide().appendTo("#boxBoy").show( "highlight", 1500);
					// scroll down so we can see the latest!
					$("#boxBoy").scrollTop($("#boxBoy")[0].scrollHeight);
				}

				
				//clicking in boxes //change user name in the overlay
				$("#boyUsernameInput").click(function() {
					$(this).val("");
				});
				$("#password").click(function() {
					$(this).val("");
				});
				
				
				
				
				// changing usernames
				$("#submitButton").click(function() {
						var textBox = document.getElementById("boyUsernameInput");
						var newUsername = $.trim($(textBox).val());
						if(newUsername != "") {
							var data = {};
							data.room = room;
							data.oldName = username;
							username = newUsername;
							data.newName = username;

							socket.emit('user changed name',data);
/* 							$(textBox).val(""); */
							//appendMessage(CHAT_ADMIN_NAME,"You now go by " + data.newName + ".",["is-admin"]);
					}

					return false;
				});
				


				// sending messages
				$("#chatInputBoy").keyup(function(evt) {

					if(evt.keyCode == KEYCODE_ENTER_BUTTON) {
						var data = {};
						data.room = room;
						data.username = username;
						data.message = $(this).val();

						socket.emit('boyChat',data);
						//appendMessage(data.username,data.message,["is-boy"]);//appends to his own page

						$(this).val(""); // clears the box for the next message.
					}

					return false;
				});

				$("#boyUsernameInput").val(username);
				$('#password').val("Password");
				//$("select").trigger("change"); // force the lobby to be selected.
			});

		</script>
	</head>
	<body id="boy">
		<center><img id="logo" src="images/logo.png"></center>
		<!--
<section id="status">
			<div id="boyStatus"></div>
			<div id="adminStatus"></div>
			<div id="girlStatus"></div>
		</section>
-->
		
		<div id="overlay">
            <div id="popup">
            	<p><input type="text" id="boyUsernameInput" val=/></p>
                <p><input type="text" id="password" /></p>
                <p id="submitButton">Submit</p>
                <a id="closeButton" href="#"><img id="closeButtonImg" src="images/chatButton.png" /></a>
            </div>
        </div>  
        
		<div id="chat">
			<center><img class="chatBackgroundImage" src="images/chatboxeBoy.png"></center>
			<div id="boxBoy" class="chatBox">
			
			</div>
			<center><input id="chatInputBoy" class="chatInput" type="text" /></center>
		</div>

	</body>
</html>